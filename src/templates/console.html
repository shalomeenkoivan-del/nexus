<!DOCTYPE html>
<html>
<head><title>Nexus</title>
<style>body{font-family:monospace;background:#111;color:#0f0;padding:30px;max-width:700px;margin:auto;}
.console{background:#000;border:2px solid #0f0;padding:25px;height:500px;overflow-y:scroll;font-size:15px;white-space: pre-wrap;line-height: 1.4;}
.prompt{color:#0f0;font-weight:bold;font-size:16px;}
input{width:80%;padding:15px;background:#222;color:#0f0;border:2px solid #0f0;font-family:monospace;font-size:15px;}
button{padding:15px 30px;background:#0f0;color:#000;border:none;cursor:pointer;font-family:monospace;font-size:15px;}
h1{color:#0f0;text-align:center;}
#status-bar{position:fixed;top:10px;right:10px;background:#000;border:1px solid #0f0;padding:10px;color:#0f0;font-size:14px;}</style>
</head>
<body>
<h1>Nexus</h1>
<div id="status-bar">Registered: 0</div>
<div id="console" class="console">
Nexus Console v1.0<br>
<br><span class="prompt">> </span>
</div>
<input id="cmd" type="text" placeholder="register/login" autofocus>
<button onclick="runCommand()">Отправить</button>

<script>
let consoleDiv = document.getElementById('console');
let statusBar = document.getElementById('status-bar');
let prompt = '> ';

function addLine(text) {
    consoleDiv.innerHTML += text + '<br>';
    consoleDiv.scrollTop = consoleDiv.scrollHeight;
}

function updateStatus() {
    fetch('/console_status')
    .then(r => r.json())
    .then(data => {
        statusBar.innerHTML = `Registered: ${data.total_users}`;
    });
}

function runCommand() {
    let cmd = document.getElementById('cmd').value.trim();
    if (!cmd) return;
    
    addLine(prompt + cmd);
    document.getElementById('cmd').value = '';
    document.getElementById('cmd').focus();
    
    fetch('/command', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({command: cmd})
    })
    .then(r => r.json())
    .then(data => {
        addLine(data.output);
        if (data.redirect) {
            setTimeout(() => window.location.href = '/chat', 2000);
        }
        addLine('<span class="prompt">' + prompt + '</span>');
        
        if (data.update_status) {
            updateStatus();
        }
    });
}

document.getElementById('cmd').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') runCommand();
});

updateStatus();
</script>
</body>
</html>